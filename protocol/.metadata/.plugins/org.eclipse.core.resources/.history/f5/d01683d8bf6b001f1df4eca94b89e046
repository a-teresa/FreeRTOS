#include "uart.h"


#define UART2EN					(1U<<17)
#define GPIOAEN					(1U<<0)

static uint16_t compute_uart_bd(uint32_t periph_clk, uint32_t baudrate);
static void uart_set_baudrate(uint32_t periph_clk, uint32_t baudrate);

#define UART_BAUDRATE 			115200
#define CLK 					72000000

void uart2_tx_init(void)
{
	/********** Configure UART GPIO pin******************/
	/*1 - Enable clock access to GPIOA*/
	RCC -> AHB1ENR=GPIOAEN;

	/*2 - Set PA2 to alternate function mode */

	GPIOA->MODER &=~(1U<<4);
	GPIOA->MODER |=(1U<<5);

	/*3 - Set PA2 to alternate function type to AF7 (UART2_TX) */

	GPIOA->AFR[0] |= (1U<<8);
	GPIOA->AFR[0] |= (1U<<9);
	GPIOA->AFR[0] |= (1U<<10);
	GPIOA->AFR[0] &= ~(1U<<11);


	/********** Configure UART module ******************/

	/*4 - Enable clock access to UART2 */
	RCC ->APB1ENR |= UART2EN;
	/*5 - Set baud rate*/
	/*6 - Set transfer direction*/
	/*7 - Enable uart module*/


}


static uint16_t compute_uart_bd(uint32_t periph_clk, uint32_t baudrate)
{
	return ((periph_clk + (baudrate/2U))/baudrate);
}

static void uart_set_baudrate(uint32_t periph_clk, uint32_t baudrate)
{
	USART1->BRR = compute_uart_bd(periph_clk, baudrate);
}
